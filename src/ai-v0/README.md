# ai-v0: 教師データ学習の目的と方針

## 1. 目的（Why）
- `proto3-hybrid_samples.csv` の教師データを使い、寸法パラメータから `safe`（0/1）を予測する初期モデルを作る。
- 生成した幾何が「安全側かどうか」を学習モデルで高速に判定し、後段の最適化・探索を効率化する。
- まずは **再現可能で壊れにくいベースライン** を作り、将来の高精度モデル比較の土台にする。

## 2. ゴール（What）
- 入力: 寸法特徴量（CSVの `safe` 以外の列）
- 出力: `safe` の2値分類（0: unsafe, 1: safe）
- 成果物:
  - 学習済みモデル
  - 前処理設定（スケーラ等）
  - 評価レポート（Accuracy / Precision / Recall / F1 / ROC-AUC）
  - 推論用スクリプト

## 3. 問題設定
- タスク: 2値分類
- 評価指標:
  - 主指標: F1, ROC-AUC
  - 補助指標: Accuracy, Precision, Recall
- 理由:
  - データ不均衡の可能性があるため、Accuracy単独で評価しない。
  - 安全判定では偽陰性/偽陽性のトレードオフ確認が重要。

## 4. アプローチ（How）
### 4.1 v0の基本方針
- まずは **MLP（全結合ニューラルネット）** を採用する。
- 同時に、比較用のシンプルな基準モデル（例: Logistic Regression）を残せる設計にする。
- 特徴量は標準化し、train/val/test を分離してリークを防ぐ。

### 4.2 学習パイプライン
1. CSV読込（`safe` をラベルとして分離）
2. train/val/test 分割（乱数seed固定）
3. 前処理（標準化）
4. モデル学習（早期終了または固定epoch）
5. 検証で閾値・過学習を確認
6. testで最終評価
7. モデルと前処理を保存

### 4.3 なぜニューラルネットか
- 寸法間の非線形な相互作用を表現しやすい。
- 将来、特徴量追加やデータ増加時に拡張しやすい。
- ただし v0 は過度な複雑化を避け、小〜中規模MLPで開始する。

## 5. 将来プラン: CAE前段ガードとしての運用
### 5.1 背景
- 将来的に本モデルは、CAE実行前の **CAD成立性フィルタ** として使う。
- CAE結果を目的関数として、Optuna がベイズ最適化で次の寸法パラメータを提案する。
- しかし提案パラメータが CAD/ソルバ観点で破綻すると、CAD生成エラーや解析中断が発生し、探索効率が大きく低下する。

### 5.2 このモデルの役割
- Optuna が提案した次パラメータに対し、事前に `safe` 確率を推論する。
- `safe` しきい値未満の候補を棄却またはペナルティ化し、探索範囲を安全側に制限する。
- これにより、ベイズ最適化が出力する次パラメータセットがCAD的に破綻してエラーになる確率を下げる。

### 5.3 Optunaとの接続イメージ
1. Optuna が候補パラメータ `x` を提案
2. 本モデルが `P(safe|x)` を推論
3. `P(safe|x) < threshold` の場合:
   - その候補をスキップ
   - もしくは大きなペナルティ目的値を返す
4. `P(safe|x) >= threshold` の場合のみ CAD生成・CAE実行
5. CAE結果を Optuna へ返し、次サイクルへ

### 5.4 導入の狙い
- CAD失敗による試行損失を削減
- CAEリソースを有効候補に集中
- ベイズ最適化の収束を安定化・高速化

### 5.5 今後の実装ステップ
- v0: `safe` 二値分類モデルを学習・評価・保存
- v1: Optuna objective にガード推論を組み込み
- v2: CAE失敗ログを再学習データとして継続学習
- v3: しきい値の自動調整（失敗率と探索効率の両立）

## 6. 成功条件（Definition of Done）
- 学習が再現可能（seed固定、手順固定）
- test評価が出力される
- モデルと前処理が保存され、同じ入力から推論できる
- 実行手順が `src/ai-v0` 内ドキュメントで完結する

## 7. リスクと対策
- データリーク: split前後の重複監視を実施
- クラス不均衡: class weight または閾値調整を検討
- 過学習: early stopping / 正則化 / dropout
- ドメインシフト: 新規生成データで再評価を定期実施

## 8. v0のスコープ外（次フェーズ）
- ハイパーパラメータ自動探索（Optuna等）
- 不確実性推定
- 形状物理ルールを組み込んだ制約学習
- モデルアンサンブル

## 9. 想定ディレクトリ（ai-v0）
- `README.md`（本ファイル）
- `train.py`（学習）
- `predict.py`（推論）
- `environment.yml`（Conda環境）
- `artifacts/`（モデル・前処理・メトリクス保存）

## 10. 運用ポリシー
- まずは「説明可能で再現可能」な最小構成を優先
- 精度改善は、ベースラインが安定してから段階的に実施
- 学習結果はメトリクスと設定をセットで保存し比較可能にする
